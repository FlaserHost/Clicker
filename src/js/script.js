"use strict";document.addEventListener("DOMContentLoaded",(()=>{const t=prompt("Как Вас зовут?"),e=document.querySelector(".main-content");e.querySelector(".user-name > span").innerText=t;const o=e.querySelector("#user-money"),r=e.querySelectorAll(".work-btn"),c=e.querySelectorAll(".level-up-btn"),s=e.querySelectorAll(".auto-btn"),a=e.querySelectorAll(".booster-btn"),n=[[s,"upgrade"],[a,"booster"]],l={upgrade:["automatic","Нанять"],booster:["booster","Купить"]},i={automatic:"Нанят",booster:"Куплено"};let u=0;const b=()=>o.innerText=`${u.toLocaleString()} ₽`;let p={cleaner:{job_level:1,job_difficult:1,job_current_cost:5,job_cost:15,job_UPD_price:50,automatic:{status:!1,price:7e4},booster:{status:!1,price:6e5}},courier:{job_level:0,job_difficult:2,job_current_cost:150,job_cost:150,job_UPD_price:3e3,automatic:{status:!1,price:15e4},booster:{status:!1,price:12e5}},factory:{job_level:0,job_difficult:3,job_current_cost:300,job_cost:300,job_UPD_price:1e4,automatic:{status:!1,price:28e4},booster:{status:!1,price:2e6}},office:{job_level:0,job_difficult:4,job_current_cost:600,job_cost:600,job_UPD_price:25e3,automatic:{status:!1,price:4e5},booster:{status:!1,price:31e5}}},d=[];const _=(t,o,r)=>{t.parentElement.classList.remove("unbought");o.parentElement.children[0].disabled=!1,n.forEach((([t,o])=>{const c=e.querySelector(`.${o}[data-property="${r}"]`),s=c.querySelector("button"),a=l[o][0],n=l[o][1],u=p[r][a].price,b=p[r][a].status;s.innerHTML=b?i[a]:`<span>${n}</span><span>${u.toLocaleString()} ₽</span>`,b&&c.classList.remove("unbought")}))},j=t=>{e.querySelector(`.job__content[data-property="${t}"] .work-btn`).innerText="Автоматически"},y=(t,e)=>{const o=t.querySelector(".job-progress-bar"),r=o.getBoundingClientRect().width,s=o.children[0],a=t.dataset.property,l=p[a].job_difficult;s.style.transitionDuration=`${l}s`,s.style.width=`${r}px`,e.disabled=!0,setTimeout((()=>{const t=p[a].job_current_cost;u+=t,b(),s.style.transitionDuration="0s",s.style.width="0",g(c,u),n.forEach((([t,e])=>S(t,e,u))),p[a].automatic.status||(e.disabled=!1)}),1e3*l)},f=(t,o=!1)=>{for(let r=0;r<t.length;r++){const c=t[r],s=e.querySelector(`.job__content[data-property="${c}"]`),a=s.querySelector(".work-btn"),n=p[c].job_difficult;p[c].automatic.status&&!o||(y(s,a),p[c].automatic.status=!0,j(c),setInterval((()=>y(s,a)),1e3*n+100))}};if(localStorage.savedData){const t=JSON.parse(localStorage.savedData);p={...t.jobs};e.querySelectorAll(".job__content").forEach((t=>{const e=t.dataset.property,o=p[e].job_level;if(o>0){const r=t.querySelector(".job-title"),c=r.children[1],s=r.children[2],a=p[e].job_current_cost;c.innerText=`Уровень ${o}`,s.innerText=`${a} ₽`;const n=p[e].job_UPD_price,l=t.querySelector(".level-up-btn");l.innerHTML=`<span>Улучшить</span><span>${n} ₽</span>`,_(t,l,e)}})),u=t.currentUserMoney,b(),0!==t.automaticJobs.length&&(d=[...t.automaticJobs],f(d,!0))}const g=(t,e)=>{t.forEach((t=>{const o=t.closest(".job__content").dataset.property,r=p[o].job_UPD_price;t.disabled=e<r}))},S=(t,e,o)=>{const r={upgrade:"automatic",booster:"booster"}[e];t.forEach((t=>{const c=t.closest(`.${e}`).dataset.property,s=p[c].job_level,a=p[c][r].status,n=p[c][r].price;t.disabled=0===s||!a&&o<n||a}))},v=t=>{const e=t.closest("article"),o=e.dataset.property,r=t.dataset.property,s=p[o][r].price;return e.classList.remove("unbought"),t.disabled=!0,t.innerText=i[r],u-=s,b(),g(c,u),n.forEach((([t,e])=>S(t,e,u))),o};r.forEach((t=>{t.addEventListener("click",(t=>{if(t.isTrusted){const e=t.target.closest(".job__content");y(e,t.target)}}))})),c.forEach((t=>{t.addEventListener("click",(t=>{const e=t.target.closest(".job__content"),o=e.dataset.property,r=p[o].job_UPD_price,s=e.querySelector(".job-level"),a=p[o].job_level+1;s.innerText=`Уровень ${a}`,p[o].job_level=a,1===a&&_(e,t.target,o);const l=e.querySelector(".job-cost"),i=p[o].job_current_cost+p[o].job_cost;l.innerText=`${i.toLocaleString()} ₽`,p[o].job_current_cost=i,u-=r;const d=2*r;t.target.innerHTML=`<span>Улучшить</span><span>${d.toLocaleString()} ₽</span>`,p[o].job_UPD_price=d,t.target.setAttribute("title",`Улучшить ${d.toLocaleString()} ₽`),b(),g(c,u),n.forEach((([t,e])=>S(t,e,u)))}))})),s.forEach((t=>{t.addEventListener("click",(t=>{const e=t.target.closest("article").dataset.property;d.push(e),f(d),j(e),v(t.target)}))})),a.forEach((t=>{t.addEventListener("click",(t=>{t.target.setAttribute("data-bought",!0);const o=v(t.target),r=p[o].job_current_cost*=3;p[o].job_current_cost=r,p[o].booster.status=!0;e.querySelector(`.job__content[data-property="${o}"] .job-cost`).innerText=`${r} ₽`}))})),g(c,u),n.forEach((([t,e])=>S(t,e,u)));let h=!1;e.querySelector("#data-reset").addEventListener("click",(()=>{h=!0,location.reload()})),window.addEventListener("beforeunload",(t=>{if(t.preventDefault(),t.returnValue="Уверены что хотите уйти?",h)localStorage.savedData="";else{const t={jobs:p,automaticJobs:d,currentUserMoney:u};localStorage.savedData=JSON.stringify(t)}}))}));